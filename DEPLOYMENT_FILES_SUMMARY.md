# Deployment Files Summary

## ğŸ“ New Files Created for Deployment

### 1. `scripts/runAllMigrations.js` â­ MOST IMPORTANT

**Purpose**: Unified migration script that runs ALL database migrations in correct order

**What it does**:

- Creates main schema (users, games, bets, transactions, etc.)
- Adds admin panel tables (notifications, popups)
- Creates banners table
- Adds popup image column
- Creates default admin user
- Seeds sample games

**When it runs**:

- Automatically during Render build process (`npm run build`)
- Can be run manually: `npm run db:migrate`

**Safe to run multiple times**: Yes! Uses `CREATE TABLE IF NOT EXISTS` and checks before inserting data.

---

### 2. `DEPLOYMENT_GUIDE.md`

**Purpose**: Comprehensive step-by-step guide for deploying to Render

**Covers**:

- Setting up PostgreSQL database
- Configuring web service
- Environment variables
- Troubleshooting common issues
- Database management
- Security checklist
- Pricing information

---

### 3. `DEPLOYMENT_CHECKLIST.md`

**Purpose**: Quick reference for deployment

**Covers**:

- Pre-deployment checklist
- Quick setup steps
- Common errors and fixes
- Post-deployment verification
- Update process

---

### 4. `render.yaml` (Optional but Recommended)

**Purpose**: Infrastructure as Code for one-click deployment

**Benefits**:

- Automatically creates database AND web service
- Pre-configures all settings
- Generates secure JWT secret
- Links database to web service

**How to use**:

1. Push to GitHub
2. In Render, click "New +" â†’ "Blueprint"
3. Select your repo
4. Render reads `render.yaml` and sets everything up
5. Just set `ADMIN_PASSWORD` and click "Apply"

---

### 5. `.renderignore`

**Purpose**: Excludes unnecessary files from deployment

**Excludes**:

- `.env` files (use environment variables instead)
- `node_modules` (installed during build)
- Development files
- Documentation (optional)

---

## ğŸ“ Modified Files

### `package.json`

**Added scripts**:

```json
"db:migrate": "node scripts/runAllMigrations.js",
"build": "node scripts/runAllMigrations.js"
```

**Why**:

- `db:migrate`: For manual migration runs
- `build`: Render runs this during deployment

---

## ğŸš€ Deployment Process

### Quick Version (Using render.yaml)

1. Push code to GitHub
2. In Render: New + â†’ Blueprint â†’ Select repo
3. Set `ADMIN_PASSWORD` environment variable
4. Click "Apply"
5. Wait 3-5 minutes
6. Done! âœ…

### Manual Version

Follow `DEPLOYMENT_GUIDE.md` step-by-step

---

## ğŸ”§ How Migrations Work

### On Render (Automatic)

```
1. GitHub push triggers deployment
2. Render runs: npm install
3. Render runs: npm run build
   â””â”€> Runs: node scripts/runAllMigrations.js
       â”œâ”€> Creates all tables
       â”œâ”€> Creates admin user
       â””â”€> Seeds games
4. Render runs: npm start
5. App is live!
```

### Locally (Manual)

```bash
# Option 1: Run all migrations
npm run db:migrate

# Option 2: Run specific migration
node database/migrations/run-banners-migration.js
```

---

## ğŸ” Environment Variables Needed

### Required (Must Set)

```env
DATABASE_URL=<from-render-database>
ADMIN_PASSWORD=<your-secure-password>
JWT_SECRET=<auto-generated-or-set-manually>
```

### Optional (Have Defaults)

```env
NODE_ENV=production
PORT=10000
JWT_EXPIRES_IN=7d
OTP_EXPIRY_MINUTES=5
MIN_BET_AMOUNT=10
MAX_BET_AMOUNT=10000
MIN_WITHDRAWAL_AMOUNT=100
```

---

## âœ… Verification Steps

After deployment, check:

1. **Build Logs** should show:

   ```
   âœ… Main schema executed successfully!
   âœ… Admin panel tables created successfully!
   âœ… Banners table created successfully!
   âœ… Popup image column added successfully!
   âœ… Default admin user created!
   âœ… Sample games created!
   ğŸ‰ All migrations completed successfully!
   ```

2. **Application Logs** should show:

   ```
   âœ… Connected to Database
   ğŸš€ Taj Matka Server Started
   ğŸ“¡ Server running on http://localhost:10000
   ```

3. **Web Access**:
   - Homepage loads: `https://your-app.onrender.com`
   - Admin login works: `https://your-app.onrender.com/admin/login`
   - Can login with: Phone `9999999999`, Password `<your-admin-password>`

---

## ğŸ› Troubleshooting

### Build Fails

- Check build logs for specific error
- Verify `package.json` has all dependencies
- Ensure `DATABASE_URL` is set correctly

### Migration Fails

- Check if using **Internal Database URL** (not External)
- Verify database is in same region as web service
- Check database logs in Render

### App Doesn't Start

- Verify `PORT=10000` is set
- Check application logs for errors
- Ensure all required env vars are set

### Can't Connect to Database

- Double-check `DATABASE_URL` format
- Ensure SSL is enabled (handled automatically in config)
- Verify database is running

---

## ğŸ“š File Reference

| File                          | Purpose               | When to Use                 |
| ----------------------------- | --------------------- | --------------------------- |
| `DEPLOYMENT_GUIDE.md`         | Detailed instructions | First-time deployment       |
| `DEPLOYMENT_CHECKLIST.md`     | Quick reference       | Every deployment            |
| `render.yaml`                 | Auto-configuration    | One-click setup             |
| `scripts/runAllMigrations.js` | Database setup        | Automatic (build) or manual |
| `.renderignore`               | Exclude files         | Automatic                   |

---

## ğŸ¯ Next Steps After Deployment

1. **Change Admin Credentials**:
   - Login to admin panel
   - Change phone number and password
   - Or update directly in database

2. **Configure SMS API**:
   - Sign up for SMS service (Twilio, MSG91, etc.)
   - Add `SMS_API_KEY` to environment variables
   - Update OTP sending code if needed

3. **Add Payment Gateway**:
   - Integrate Razorpay/Paytm/etc.
   - Update deposit/withdrawal flows

4. **Customize Games**:
   - Add/edit games in admin panel
   - Set proper timings for your timezone

5. **Test Everything**:
   - User registration
   - Betting flow
   - Wallet operations
   - Admin functions

6. **Set Up Monitoring**:
   - Use Render's built-in monitoring
   - Set up error tracking (Sentry, etc.)
   - Configure database backups

7. **Go Live**:
   - Add custom domain
   - Update DNS settings
   - Enable HTTPS (automatic on Render)
   - Announce to users!

---

## ğŸ’° Cost Estimate

### Free Tier (Testing)

- Database: Free (1GB, 97 hours/month)
- Web Service: Free (750 hours/month)
- **Total**: $0/month
- **Limitation**: Spins down after 15 min inactivity

### Production Tier

- Database: $7/month (1GB, always on)
- Web Service: $7/month (512MB RAM, always on)
- **Total**: $14/month
- **Benefits**: Always on, no spin down, better performance

---

## ğŸ‰ Success Criteria

Your deployment is successful when:

- âœ… Build completes without errors
- âœ… All migrations run successfully
- âœ… Application starts and stays running
- âœ… Can access homepage
- âœ… Can login to admin panel
- âœ… Can see games and place bets
- âœ… Database has all tables and data

---

**You're all set! Follow the guides and you'll be deployed in minutes! ğŸš€**
