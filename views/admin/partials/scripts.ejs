<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const sidebar = document.getElementById('sidebar');
        const content = document.getElementById('content');
        const btnCollapse = document.getElementById('sidebarCollapse');
        const btnToggle = document.getElementById('sidebarToggle');
        const btnCloseSidebar = document.getElementById('sidebarClose');

        // Support both old and new toggle buttons
        const toggleButton = btnCollapse || btnToggle;
        const overlay = document.getElementById('sidebar-overlay');

        if (toggleButton) {
            toggleButton.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                content.classList.toggle('active');
                if (window.innerWidth <= 992) {
                    overlay.classList.toggle('active');
                    document.body.classList.toggle('sidebar-open');
                }
            });
        }

        if (btnCloseSidebar) {
            btnCloseSidebar.addEventListener('click', function() {
                sidebar.classList.remove('active');
                content.classList.remove('active');
                overlay.classList.remove('active');
                document.body.classList.remove('sidebar-open');
            });
        }

        if (overlay) {
            overlay.addEventListener('click', function() {
                sidebar.classList.remove('active');
                content.classList.remove('active');
                overlay.classList.remove('active');
                document.body.classList.remove('sidebar-open');
            });
        }

        // Adjust for mobile initially
        if (window.innerWidth <= 992 && sidebar && content) {
            sidebar.classList.remove('active');
            content.classList.remove('active');
            if (overlay) overlay.classList.remove('active');
            document.body.classList.remove('sidebar-open');
        }
    });

    // Helper function for API calls
    async function apiCall(url, method = 'GET', data = null) {
        const options = {
            method,
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        };
        if (data) options.body = JSON.stringify(data);

        try {
            const response = await fetch(url, options);
            const result = await response.json();
            if (!response.ok) throw new Error(result.message || 'Something went wrong');
            return result;
        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: error.message
            });
            throw error;
        }
    }
    async function handleLogout() {
        try {
            const result = await apiCall('/api/auth/logout', 'POST');
            if (result.success) {
                window.location.href = '/login';
            }
        } catch (error) {
            console.error('Logout failed:', error);
        }
    }
</script>
