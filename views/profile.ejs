<% 
const currentPage = 'profile';
const title = 'My Profile';
%>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title><%= title %> - Taj Matka</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="mobile-container">
        
        <!-- Fixed Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <button class="menu-btn" onclick="window.history.back()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                    </button>
                    <h1 class="app-logo">MY PROFILE</h1>
                </div>
                <div class="header-right">
                    <button class="menu-btn" onclick="logout()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <div class="page-content">
                
                <!-- User Info Card -->
                <div style="background: linear-gradient(135deg, #FF4500 0%, #8B0000 100%); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; text-align: center;">
                    <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center;">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <h2 id="userName" style="font-size: 1.3rem; margin-bottom: 0.25rem;">Loading...</h2>
                    <p id="userPhone" style="font-size: 0.9rem; opacity: 0.9;">+91 XXXXXXXXXX</p>
                </div>

                <!-- Wallet Section -->
                <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem;">
                    <h3 style="color: #FF4500; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="5" width="20" height="14" rx="2"></rect>
                            <line x1="2" y1="10" x2="22" y2="10"></line>
                        </svg>
                        Wallet
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div style="background: var(--bg-input); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.75rem; color: #666; margin-bottom: 0.5rem;">Main Balance</div>
                            <div style="font-size: 1.3rem; font-weight: 700; color: #FF4500;" id="mainBalance">₹0</div>
                        </div>
                        <div style="background: var(--bg-input); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 0.75rem; color: #666; margin-bottom: 0.5rem;">Winning Balance</div>
                            <div style="font-size: 1.3rem; font-weight: 700; color: #00ff88;" id="winningBalance">₹0</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-input); padding: 1rem; border-radius: 8px; text-align: center; margin-bottom: 1rem;">
                        <div style="font-size: 0.75rem; color: #666; margin-bottom: 0.5rem;">Total Balance</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #fff;" id="totalBalance">₹0</div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                        <button class="btn btn-play" onclick="window.location.href='/deposit'">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Funds
                        </button>
                        <button class="btn btn-secondary" onclick="window.location.href='/withdraw'">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Withdraw
                        </button>
                    </div>
                </div>

                <!-- Statistics -->
                <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem;">
                    <h3 style="color: #FF4500; margin-bottom: 1rem;">Statistics</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: #FF4500;" id="totalBets">0</div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem;">Total Bets</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: #00ff88;" id="totalWins">0</div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem;">Total Wins</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: #ff4444;" id="totalLosses">0</div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem;">Total Losses</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: #ffaa00;" id="pendingBets">0</div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem;">Pending</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 12px;">
                    <h3 style="color: #FF4500; margin-bottom: 1rem;">Quick Actions</h3>
                    
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <button class="btn btn-secondary" onclick="window.location.href='/history'" style="justify-content: flex-start;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            Bet History
                        </button>
                        <button class="btn btn-secondary" onclick="window.location.href='/transactions'" style="justify-content: flex-start;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                            Transactions
                        </button>
                        <button class="btn btn-secondary" onclick="window.location.href='/results'" style="justify-content: flex-start;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                            </svg>
                            Results
                        </button>
                    </div>
                </div>

            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="/home" class="nav-item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>Home</span>
            </a>
            <a href="/results" class="nav-item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                    <path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>
                </svg>
                <span>Results</span>
            </a>
            <a href="/history" class="nav-item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <span>History</span>
            </a>
            <a href="/chart" class="nav-item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
                <span>Chart</span>
            </a>
            <a href="/profile" class="nav-item active">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span>Profile</span>
            </a>
        </nav>

    </div>

    <!-- Scripts -->
    <script src="/js/app.js"></script>
    <script>
        // Load user profile data
        async function loadProfile() {
            if (!isLoggedIn()) {
                window.location.href = '/login';
                return;
            }

            try {
                // Get user info
                const userResponse = await API.get('/auth/me');
                if (userResponse.success) {
                    const user = userResponse.data;
                    document.getElementById('userName').textContent = user.name || 'User';
                    document.getElementById('userPhone').textContent = `+91 ${user.phone}`;
                }

                // Get wallet info
                const walletResponse = await API.get('/wallet');
                if (walletResponse.success) {
                    const wallet = walletResponse.data;
                    document.getElementById('mainBalance').textContent = `₹${parseFloat(wallet.balance).toFixed(2)}`;
                    document.getElementById('winningBalance').textContent = `₹${parseFloat(wallet.winning_balance).toFixed(2)}`;
                    document.getElementById('totalBalance').textContent = `₹${parseFloat(wallet.total_balance).toFixed(2)}`;
                }

                // Get bet statistics
                const statsResponse = await API.get('/bets/stats');
                if (statsResponse.success) {
                    const stats = statsResponse.data;
                    document.getElementById('totalBets').textContent = stats.total_bets || 0;
                    document.getElementById('totalWins').textContent = stats.total_wins || 0;
                    document.getElementById('totalLosses').textContent = stats.total_losses || 0;
                    document.getElementById('pendingBets').textContent = stats.pending_bets || 0;
                }

            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        loadProfile();
    </script>
</body>
</html>
